#!/usr/bin/env bash

echo "=== Installing network tools ===" &&
npm install &&

echo "=== Creating the virtual machine ===" &&
bin/create &&

echo "=== Setting up the networking ===" &&
bin/network &&

echo "=== Building the containers ===" &&
bin/build &&

echo "=== Setting up databases ===" &&
eval "$(docker-machine env lacqueristas)" &&
docker-compose up -d --remove-orphans postgres &&
sleep 4 &&
bin/postgres createdb lacqueristas_development -U postgres -h postgres &&
bin/postgres createdb lacqueristas_test -U postgres -h postgres &&

echo "=== Turning on services ===" &&
bin/up &&

echo "=== Seeding databases ===" &&
bin/origin bin/rake db:migrate db:seed &&

echo "=== Cleaning up orphans and temporary files ===" &&
bin/clean &&

echo "=== Restarting services ===" &&
bin/restart
